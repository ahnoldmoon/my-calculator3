# .github/workflows/deploy.yml - ì—ëŸ¬ ìˆ˜ì • ë²„ì „
name: ì‹¤ì œ ì›¹ì‚¬ì´íŠ¸ ë°°í¬

on:
  push:
    branches: [ main ]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  # 1ë‹¨ê³„: í…ŒìŠ¤íŠ¸
  test:
    name: ì›¹ì‚¬ì´íŠ¸ í…ŒìŠ¤íŠ¸
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      uses: actions/checkout@v4  # v3 â†’ v4ë¡œ ì—…ë°ì´íŠ¸
    
    - name: ğŸ§ª HTML ë¬¸ë²• ê²€ì‚¬
      run: |
        echo "HTML íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸..."
        if [ -f "index.html" ]; then
          echo "âœ… index.html íŒŒì¼ ë°œê²¬!"
          if grep -q "<html" index.html && grep -q "</html>" index.html; then
            echo "âœ… HTML êµ¬ì¡° ì •ìƒ!"
          else
            echo "âŒ HTML êµ¬ì¡°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤!"
            exit 1
          fi
        else
          echo "âŒ index.html íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤!"
          exit 1
        fi

  # 2ë‹¨ê³„: ë°°í¬ (ì—ëŸ¬ ìˆ˜ì •ë¨!)
  deploy:
    name: ğŸš€ ì‹¤ì œ ì›¹ì‚¬ì´íŠ¸ ë°°í¬
    needs: test
    runs-on: ubuntu-latest
    
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
    - name: ğŸ“¥ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      uses: actions/checkout@v4  # ğŸ”§ v3 â†’ v4ë¡œ ì—…ë°ì´íŠ¸
    
    - name: ğŸ”§ GitHub Pages ì„¤ì •
      uses: actions/configure-pages@v4  # ğŸ”§ v3 â†’ v4ë¡œ ì—…ë°ì´íŠ¸
    
    - name: ğŸ“¦ ì›¹ì‚¬ì´íŠ¸ íŒŒì¼ ì¤€ë¹„
      uses: actions/upload-pages-artifact@v3  # ğŸ”§ v2 â†’ v3ìœ¼ë¡œ ì—…ë°ì´íŠ¸
      with:
        path: '.'
    
    - name: ğŸŒ GitHub Pagesì— ì‹¤ì œ ë°°í¬!
      id: deployment
      uses: actions/deploy-pages@v4  # ğŸ”§ v2 â†’ v4ë¡œ ì—…ë°ì´íŠ¸
    
    - name: ğŸ‰ ë°°í¬ ì™„ë£Œ ì•Œë¦¼
      run: |
        echo "ğŸŠ ì‹¤ì œ ì›¹ì‚¬ì´íŠ¸ ë°°í¬ ì™„ë£Œ!"
        echo "ğŸŒ ì ‘ì† ì£¼ì†Œ: ${{ steps.deployment.outputs.page_url }}"
        echo "ğŸ“… ë°°í¬ ì‹œê°„: $(date)"
        echo "âœ… ì´ì œ ì „ì„¸ê³„ ì–´ë””ì„œë“  ì ‘ì†í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!"
